
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø³ â€” {{ lesson.title }}</title>
  <style>
    :root { --bg:#fff; --bd:#e7e7e7; --muted:#666; --ink:#111; --pill:#eef; --pillbd:#dde; --ok:#0a7; --warn:#c00; }
    body{font-family:system-ui,Tahoma; margin:2rem; color:var(--ink);}
    .mngr__head{display:flex; justify-content:space-between; align-items:center; gap:1rem; flex-wrap:wrap}
    .badge{display:inline-block; background:var(--pill); border:1px solid var(--pillbd); padding:.25rem .6rem; border-radius:8px; font-size:.9rem; margin-inline-end:.25rem}
    .btn{padding:.5rem .8rem; border-radius:10px; border:1px solid #ccc; text-decoration:none; display:inline-block; cursor:pointer; background:#fff}
    .btn:hover{background:#f7f7f7}
    .btn--danger{border-color:#f3d0d0}
    .btn--danger:hover{background:#fff6f6}
    .card{border:1px solid var(--bd); border-radius:14px; padding:1rem; background:var(--bg)}
    .mngr__grid{display:grid; gap:1rem; grid-template-columns: 1fr; margin-top:1rem}
    @media (min-width: 980px){ .mngr__grid{grid-template-columns: 1.2fr .8fr} }
    .inp{width:100%; padding:.6rem .7rem; border:1px solid #ccc; border-radius:10px}
    .row{display:flex; gap:.6rem; flex-wrap:wrap; align-items:center}
    .muted{color:var(--muted)}
    h1{margin:.6rem 0 0 0}
    h2{margin:0 0 .6rem 0; font-size:1.1rem}

    /* Ø£Ø³Ø¦Ù„Ø© */
    .filters{display:flex; gap:.4rem; flex-wrap:wrap; margin:.3rem 0 1rem}
    .chip{border:1px solid var(--bd); background:#fafafa; border-radius:999px; padding:.25rem .65rem; cursor:pointer; font-size:.92rem}
    .chip--active{border-color:#bcd; background:#f4f8ff}
    .qwrap{display:grid; gap:.8rem}
    .qcard{border:1px solid var(--bd); border-radius:12px; padding:.8rem}
    .qcard__meta{display:flex; gap:.4rem; align-items:center; font-size:.85rem; color:var(--muted)}
    .pill{background:var(--pill); border:1px solid var(--pillbd); border-radius:999px; padding:.1rem .5rem}
    .qcard__title{margin:.35rem 0 .2rem 0; font-weight:600}
    .choices{list-style:none; padding:0; margin:.2rem 0 .4rem 0}
    .choices li{padding:.25rem .5rem; border-radius:8px; border:1px dashed transparent; display:flex; align-items:center; gap:.4rem}
    .choices li.ok{border-color:#d6f0e3; background:#f6fff9}
    .editblk{display:none; margin-top:.6rem; border-top:1px dashed var(--bd); padding-top:.6rem}
    .editblk .inp{margin:.2rem 0}
    .qcard__actions .btn{font-size:.92rem}
    .qcard__actions{display:flex; gap:.5rem; flex-wrap:wrap}

    /* Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .toolbar .btn{cursor:pointer}
    #m_editor ul, #m_editor ol { padding-inline-start: 1.25rem; }
    #m_editor p { margin: .2rem 0; }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª (Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©) */
    .seg{display:flex; gap:.4rem; align-items:center; flex-wrap:wrap}
    .seg__btn{
      width:36px; height:36px; border-radius:50%;
      border:1px solid #ccc; background:#fff; cursor:pointer;
      font-weight:700; line-height:36px; text-align:center
    }
    .seg__btn.active{background:#e9f9ee; border-color:#2a7d46; color:#2a7d46}

    /* Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ© */
    .palette{display:flex; gap:.4rem; align-items:center; flex-wrap:wrap}
    .sw{
      width:24px; height:24px; border-radius:50%;
      border:1px solid #bbb; cursor:pointer; display:inline-block;
    }
    .sw:focus{outline:2px solid #999}
  </style>
</head>
<body>
  <div class="mngr__head">
    <div>
      <span class="badge">Ø§Ù„Ø³Ù†Ø©: {{ term.year }}</span>
      <span class="badge">Ø§Ù„ÙØµÙ„: {{ term.get_number_display }}</span>
      <span class="badge">Ø§Ù„Ù…Ø§Ø¯Ø©: {{ subject.name }}</span>
      <span class="badge">Ø§Ù„Ø¯Ø±Ø³: {{ lesson.title }}</span>
    </div>
    <div class="row">
      <a class="btn" href="{% url 'lessons_list' term.id subject.id %}">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¯Ø±ÙˆØ³</a>
    </div>
  </div>

  <h1>{{ lesson.title }}</h1>

  <div class="mngr__grid">
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³ -->
    <section class="card">
      <h2>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³: {{ lesson.title }}</h2>

      <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
      <div class="toolbar" style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.6rem">
        <button class="btn" type="button" id="m_bold"><strong>B</strong></button>
        <button class="btn" type="button" id="m_ul">â€¢ Ù‚Ø§Ø¦Ù…Ø©</button>
        <button class="btn" type="button" id="m_ol">1. ØªØ¹Ø¯Ø§Ø¯</button>

        <!-- Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ© -->
        <div class="palette" aria-label="Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ">
          <span class="muted">Ø§Ù„Ù„ÙˆÙ†:</span>
          <button class="sw" data-color="#000000" title="Ø£Ø³ÙˆØ¯" style="background:#000000"></button>
          <button class="sw" data-color="#d10000" title="Ø£Ø­Ù…Ø±" style="background:#d10000"></button>
          <button class="sw" data-color="#0057d1" title="Ø£Ø²Ø±Ù‚" style="background:#0057d1"></button>
          <button class="sw" data-color="#17823a" title="Ø£Ø®Ø¶Ø±" style="background:#17823a"></button>
        </div>

        <button class="btn" type="button" id="m_clean">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ</button>
        <!-- Ø­ÙØ¸ ÙŠØ±Ø³Ù„ Ù†ÙØ³ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
        <button class="btn" type="submit" form="contentForm">ğŸ’¾ Ø­ÙØ¸</button>
      </div>

      <form method="post" id="contentForm" class="stack">
        {% csrf_token %}
        <input type="hidden" name="form_name" value="content" />
        <!-- Ø­Ù‚Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø®ÙÙŠ: Ø³Ù†Ù†Ø³Ø® Ù„Ù‡ HTML Ø§Ù„Ù…Ø­Ø±Ù‘Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
        <div style="display:none">{{ cform.body }}</div>

        <!-- Ø§Ù„Ù…Ø­Ø±Ù‘Ø± -->
        <div id="m_editor"
            contenteditable="true"
            style="line-height:1.9; min-height:220px; border:1px dashed #bbb; padding:1rem; border-radius:10px; background:#fff;">
        </div>

        <small class="muted" style="display:block;margin-top:.4rem">
          ØªÙ„Ù…ÙŠØ­: Ø­Ø¯Ù‘Ø¯ Ù†ØµÙ‹Ø§ Ø«Ù… Ø§Ø¶ØºØ· <strong>B</strong> Ù„Ø¹Ù…Ù„Ù‡ Ø¹Ø±ÙŠØ¶Ù‹Ø§.  
          Ø£Ø²Ø±Ø§Ø± <strong>â€¢ Ù‚Ø§Ø¦Ù…Ø©</strong> Ùˆ<strong>1. ØªØ¹Ø¯Ø§Ø¯</strong> ØªÙØ¶ÙŠÙØ§Ù† Ù‚ÙˆØ§Ø¦Ù….  
          Ø§Ø®ØªØ± Ù„ÙˆÙ†Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ù„ØªØ·Ø¨ÙŠÙ‚Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ¯. Ø²Ø± ğŸ§¹ ÙŠÙÙ†Ø¸Ù‘Ù Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©.
        </small>
      </form>
    </section>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ -->
    <section class="card">
      <h2>Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† 3)</h2>
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="form_name" value="add_question" />

        <!-- Ù†Ø±Ø³Ù„ Ø§Ù„Ù‚Ø³Ù… Ù‡Ù†Ø§ (Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ FULL) -->
        <input type="hidden" name="section" id="add_section" value="FULL" />

        <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
        {{ qform.text }}

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
        <div class="row" style="margin-top:.4rem">
          <div style="font-weight:600">Ø§Ù„Ù‚Ø³Ù…:</div>
          <div class="seg" id="seg_section">
            <button type="button" class="seg__btn" data-val="FIRST"  title="Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„">â‘ </button>
            <button type="button" class="seg__btn" data-val="SECOND" title="Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ">â‘¡</button>
            <span class="muted" id="seg_hint">Ù„Ù… ØªØ®ØªØ± Ù‚Ø³Ù…Ù‹Ø§ â†’ Ø³ÙŠÙØ­ÙØ¸ Ø¶Ù…Ù† <strong>ÙƒØ§Ù…Ù„ Ø§Ù„Ù‚Ø³Ù…</strong>.</span>
          </div>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
        <div class="row" style="margin-top:.4rem">
          <div style="font-weight:600">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</div>
          <input type="hidden" name="correct" id="add_correct" value="1" />
          <div class="seg" id="seg_correct_add">
            <button type="button" class="seg__btn active" data-val="1">1</button>
            <button type="button" class="seg__btn" data-val="2">2</button>
            <button type="button" class="seg__btn" data-val="3">3</button>
          </div>
        </div>

        <label>Ø§Ù„Ø®ÙŠØ§Ø± 1</label>
        {{ qform.choice1 }}
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 2</label>
        {{ qform.choice2 }}
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 3</label>
        {{ qform.choice3 }}

        <div class="row" style="margin-top:.6rem">
          <button class="btn" type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„</button>
        </div>
      </form>
    </section>
  </div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
  <section class="card" style="margin-top:1rem">
    <div class="row" style="justify-content:space-between; align-items:center">
      <h2 style="margin:0">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
      <div class="filters" id="filters">
        <button class="chip chip--active" data-filter="ALL">Ø§Ù„ÙƒÙ„</button>
        <button class="chip" data-filter="FIRST">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</button>
        <button class="chip" data-filter="SECOND">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
        <button class="chip" data-filter="FULL">ÙƒØ§Ù…Ù„ Ø§Ù„Ù‚Ø³Ù…</button>
      </div>
    </div>

    <div class="qwrap" id="qwrap">
      {% for q in questions %}
        <div class="qcard" data-section="{{ q.section }}" id="q-{{ q.id }}">
          <div class="qcard__meta">
            <span class="pill">{{ q.get_section_display }}</span>
            <span class="muted">#{{ forloop.counter }}</span>
          </div>

          <div class="qcard__title">Ø³: {{ q.text }}</div>

          <ul class="choices">
            <li class="{% if q.correct == 1 %}ok{% endif %}">1) {{ q.choice1 }} {% if q.correct == 1 %}âœ”{% endif %}</li>
            <li class="{% if q.correct == 2 %}ok{% endif %}">2) {{ q.choice2 }} {% if q.correct == 2 %}âœ”{% endif %}</li>
            <li class="{% if q.correct == 3 %}ok{% endif %}">3) {{ q.choice3 }} {% if q.correct == 3 %}âœ”{% endif %}</li>
          </ul>

          <div class="qcard__actions">
            <button class="btn" type="button" onclick="toggleEdit({{ q.id }})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>

            <form method="post" class="inline" onsubmit="return confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ');">
              {% csrf_token %}
              <input type="hidden" name="form_name" value="delete_question" />
              <input type="hidden" name="question_id" value="{{ q.id }}" />
              <button class="btn btn--danger" type="submit">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </form>
          </div>

          <!-- Ø¨Ù„ÙˆÙƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
          <div class="editblk" id="edit-{{ q.id }}">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="form_name" value="edit_question_{{ q.id }}" />
              <input type="hidden" name="question_id" value="{{ q.id }}" />

              <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
              <textarea name="text" class="inp" rows="2">{{ q.text }}</textarea>

              <div class="row">
                <div style="flex:1">
                  <label>Ø§Ù„Ù‚Ø³Ù…</label>
                  <select name="section" class="inp">
                    {% for val,label in SECTION_CHOICES %}
                      <option value="{{ val }}" {% if q.section == val %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div style="flex:1">
                  <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                  <div class="seg" data-input="correct-{{ q.id }}">
                    <button type="button" class="seg__btn {% if q.correct == 1 %}active{% endif %}" data-val="1">1</button>
                    <button type="button" class="seg__btn {% if q.correct == 2 %}active{% endif %}" data-val="2">2</button>
                    <button type="button" class="seg__btn {% if q.correct == 3 %}active{% endif %}" data-val="3">3</button>
                  </div>
                  <input type="hidden" name="correct" id="correct-{{ q.id }}" value="{{ q.correct }}" />
                </div>
              </div>

              <label>Ø§Ù„Ø®ÙŠØ§Ø± 1</label>
              <input name="choice1" class="inp" value="{{ q.choice1 }}" />
              <label>Ø§Ù„Ø®ÙŠØ§Ø± 2</label>
              <input name="choice2" class="inp" value="{{ q.choice2 }}" />
              <label>Ø§Ù„Ø®ÙŠØ§Ø± 3</label>
              <input name="choice3" class="inp" value="{{ q.choice3 }}" />

              <div class="row" style="margin-top:.6rem">
                <button class="btn" type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="btn" type="button" onclick="toggleEdit({{ q.id }})">Ø¥ØºÙ„Ø§Ù‚</button>
              </div>
            </form>
          </div>
        </div>
      {% empty %}
        <div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯.</div>
      {% endfor %}
    </div>
  </section>

  <script>
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… (Ø¹Ø±Ø¶ ÙÙ‚Ø·)
    const filters = document.getElementById('filters');
    const qwrap   = document.getElementById('qwrap');
    filters?.addEventListener('click', (e) => {
      if(e.target.matches('.chip')){
        [...filters.children].forEach(c => c.classList.remove('chip--active'));
        e.target.classList.add('chip--active');
        const v = e.target.dataset.filter;
        [...qwrap.children].forEach(card => {
          if(v === 'ALL' || card.dataset.section === v) card.style.display = '';
          else card.style.display = 'none';
        });
      }
    });

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ø­Ø±Ø± Ø³Ø¤Ø§Ù„
    function toggleEdit(id){
      const el = document.getElementById('edit-'+id);
      if(!el) return;
      el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }
  </script>

  <!-- Ø³ÙƒØ±Ø¨Øª Ù…Ø­Ø±Ù‘Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ©) -->
  <script>
    const editor  = document.getElementById('m_editor');
    const bodyFld = document.getElementById('id_body'); // Ù…Ù† cform.body
    const btnBold = document.getElementById('m_bold');
    const btnUL   = document.getElementById('m_ul');
    const btnOL   = document.getElementById('m_ol');
    const clean   = document.getElementById('m_clean');

    // Ø­Ù…Ù‘Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ù‘Ø±
    editor.innerHTML = bodyFld ? bodyFld.value : '';

    function focusEditor(){ editor.focus(); }

    // Ø£Ø¯ÙˆØ§Øª ØªÙ†Ø³ÙŠÙ‚ Ø£Ø³Ø§Ø³ÙŠØ©
    btnBold?.addEventListener('click', () => { focusEditor(); document.execCommand('bold', false, null); });
    btnUL  ?.addEventListener('click', () => { focusEditor(); document.execCommand('insertUnorderedList', false, null); });
    btnOL  ?.addEventListener('click', () => { focusEditor(); document.execCommand('insertOrderedList', false, null); });

    // Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†: 4 Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ©
    document.querySelectorAll('.palette .sw').forEach(sw => {
      sw.addEventListener('click', () => {
        const color = sw.dataset.color;
        focusEditor();
        document.execCommand('foreColor', false, color);
      });
    });

    // ØªÙ†Ø¸ÙŠÙ: Ø¥Ø²Ø§Ù„Ø© &nbsp;ØŒ ØªÙ‚Ù„ÙŠØµ Ø§Ù„Ù…Ø³Ø§ÙØ§ØªØŒ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø­ÙˆÙ„ Ø§Ù„ÙˆØ³ÙˆÙ…
    clean  ?.addEventListener('click', () => {
      const html = editor.innerHTML
        .replace(/&nbsp;/g, ' ')
        .replace(/\s{2,}/g, ' ')
        .replace(/>\s+/g, '>')
        .replace(/\s+</g, '<')
        .trim();
      editor.innerHTML = html;
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸: Ø§Ù†Ø³Ø® HTML Ù„Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ù…Ø®ÙÙŠ body ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('contentForm')?.addEventListener('submit', () => {
      if (bodyFld) bodyFld.value = editor.innerHTML.trim();
    });
  </script>

  <!-- Ø³ÙƒØ±Ø¨Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª) -->
  <script>
    // =========== ØªØ­Ø¯ÙŠØ¯ "Ø§Ù„Ù‚Ø³Ù…" ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ===========
    (function(){
      const hidden = document.getElementById('add_section');   // FULL Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
      const wrap   = document.getElementById('seg_section');
      const hint   = document.getElementById('seg_hint');
      if (!hidden || !wrap) return;
      const btns = wrap.querySelectorAll('.seg__btn');

      function setVal(v){
        hidden.value = v || 'FULL';
        btns.forEach(b => b.classList.toggle('active', b.dataset.val === v));
        if (hint){
          if (v === 'FIRST')  hint.innerHTML = 'Ø³ÙŠÙØ­ÙØ¸ Ø¶Ù…Ù† <strong>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</strong>.';
          else if (v === 'SECOND') hint.innerHTML = 'Ø³ÙŠÙØ­ÙØ¸ Ø¶Ù…Ù† <strong>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</strong>.';
          else hint.innerHTML = 'Ù„Ù… ØªØ®ØªØ± Ù‚Ø³Ù…Ù‹Ø§ â†’ Ø³ÙŠÙØ­ÙØ¸ Ø¶Ù…Ù† <strong>ÙƒØ§Ù…Ù„ Ø§Ù„Ù‚Ø³Ù…</strong>.';
        }
      }
      btns.forEach(b => b.addEventListener('click', () => {
        // Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø²Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (ÙŠØ±Ø¬Ø¹ FULL)
        setVal(b.classList.contains('active') ? null : b.dataset.val);
      }));
      setVal(hidden.value); // ÙŠØ¨Ø¯Ø£ Ø¨Ù„Ø§ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø¦ÙŠ = FULL
    })();

    // =========== ØªØ­Ø¯ÙŠØ¯ "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©" ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ===========
    (function(){
      const hidden = document.getElementById('add_correct');  // 1 Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
      const wrap   = document.getElementById('seg_correct_add');
      if (!hidden || !wrap) return;
      const btns = wrap.querySelectorAll('.seg__btn');

      function setVal(v){
        hidden.value = v;
        btns.forEach(b => b.classList.toggle('active', b.dataset.val === v));
      }
      btns.forEach(b => b.addEventListener('click', () => setVal(b.dataset.val)));
      setVal(hidden.value);
    })();

    // =========== ØªØ­Ø¯ÙŠØ¯ "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©" Ø¯Ø§Ø®Ù„ Ù…Ø­Ø±Ø± ÙƒÙ„ Ø³Ø¤Ø§Ù„ ===========
    (function(){
      document.querySelectorAll('.seg[data-input^="correct-"]').forEach(group => {
        const inputId = group.dataset.input;
        const hidden  = document.getElementById(inputId);
        if (!hidden) return;
        const btns = group.querySelectorAll('.seg__btn');

        function setVal(v){
          hidden.value = v;
          btns.forEach(b => b.classList.toggle('active', b.dataset.val === v));
        }
        btns.forEach(b => b.addEventListener('click', () => setVal(b.dataset.val)));
        setVal(hidden.value); // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
      });
    })();
  </script>
</body>
</html>
