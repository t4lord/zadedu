<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø³ â€” {{ lesson.title }}</title>
  <style>
    :root { --bg:#fff; --bd:#e7e7e7; --muted:#666; --ink:#111; --pill:#eef; --pillbd:#dde; }
    body{font-family:system-ui,Tahoma; margin:2rem; color:var(--ink); background:var(--bg)}
    .mngr__head{display:flex; justify-content:space-between; align-items:center; gap:1rem; flex-wrap:wrap}
    .badge{display:inline-block; background:var(--pill); border:1px solid var(--pillbd); padding:.25rem .6rem; border-radius:8px; font-size:.9rem; margin-inline-end:.25rem}
    .btn{padding:.5rem .8rem; border-radius:10px; border:1px solid #ccc; text-decoration:none; display:inline-block; cursor:pointer; background:#fff}
    .btn:hover{background:#f7f7f7}
    .card{border:1px solid var(--bd); border-radius:14px; padding:1rem; background:var(--bg)}
    .mngr__grid{display:grid; gap:1rem; grid-template-columns: 1fr; margin-top:1rem}
    .inp{width:100%; padding:.6rem .7rem; border:1px solid #ccc; border-radius:10px}
    .row{display:flex; gap:.6rem; flex-wrap:wrap; align-items:center}
    .muted{color:var(--muted)}
    h1{margin:.6rem 0 0 0}
    h2{margin:0 0 .6rem 0; font-size:1.1rem}

    /* Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.6rem}
    .toolbar .btn{cursor:pointer}
    #m_editor{line-height:1.9; min-height:220px; border:1px dashed #bbb; padding:1rem; border-radius:10px; background:#fff;}
    #m_editor ul, #m_editor ol { padding-inline-start: 1.25rem; }
    #m_editor p { margin: .2rem 0; }

    /* Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ© */
    .palette{display:flex; gap:.4rem; align-items:center; flex-wrap:wrap}
    .sw{
      width:24px; height:24px; border-radius:50%;
      border:1px solid #bbb; cursor:pointer; display:inline-block;
    }
    .sw:focus{outline:2px solid #999}
  </style>
</head>
<body>
  <div class="mngr__head">
    <div>
      <span class="badge">Ø§Ù„Ø³Ù†Ø©: {{ term.year }}</span>
      <span class="badge">Ø§Ù„ÙØµÙ„: {{ term.get_number_display }}</span>
      <span class="badge">Ø§Ù„Ù…Ø§Ø¯Ø©: {{ subject.name }}</span>
      <span class="badge">Ø§Ù„Ø¯Ø±Ø³: {{ lesson.title }}</span>
    </div>
    <div class="row">
      <a class="btn" href="{% url 'lessons_list' term.id subject.id %}">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¯Ø±ÙˆØ³</a>
    </div>
  </div>

  <h1>{{ lesson.title }}</h1>

  <div class="mngr__grid">
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³ ÙÙ‚Ø· -->
    <section class="card">
      <h2>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³: {{ lesson.title }}</h2>

      <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
      <div class="toolbar">
        <button class="btn" type="button" id="m_bold"><strong>B</strong></button>
        <button class="btn" type="button" id="m_ul">â€¢ Ù‚Ø§Ø¦Ù…Ø©</button>
        <button class="btn" type="button" id="m_ol">1. ØªØ¹Ø¯Ø§Ø¯</button>

        <!-- Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ© -->
        <div class="palette" aria-label="Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ">
          <span class="muted">Ø§Ù„Ù„ÙˆÙ†:</span>
          <button class="sw" data-color="#000000" title="Ø£Ø³ÙˆØ¯" style="background:#000000"></button>
          <button class="sw" data-color="#d10000" title="Ø£Ø­Ù…Ø±" style="background:#d10000"></button>
          <button class="sw" data-color="#0057d1" title="Ø£Ø²Ø±Ù‚" style="background:#0057d1"></button>
          <button class="sw" data-color="#17823a" title="Ø£Ø®Ø¶Ø±" style="background:#17823a"></button>
        </div>

        <button class="btn" type="button" id="m_clean">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ</button>
        <button class="btn" type="submit" form="contentForm">ğŸ’¾ Ø­ÙØ¸</button>
      </div>

      <form method="post" id="contentForm" class="stack" action="">
        {% csrf_token %}
        <input type="hidden" name="form_name" value="content" />
        <!-- Ø­Ù‚Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø®ÙÙŠ: Ø³ÙŠØªÙ… Ù†Ø³Ø® HTML Ø§Ù„Ù…Ø­Ø±Ù‘Ø± Ù„Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
        <div style="display:none">{{ cform.body }}</div>

        <!-- Ø§Ù„Ù…Ø­Ø±Ù‘Ø± -->
        <div id="m_editor" contenteditable="true"></div>

        <small class="muted" style="display:block;margin-top:.4rem">
          ØªÙ„Ù…ÙŠØ­: Ø­Ø¯Ù‘Ø¯ Ù†ØµÙ‹Ø§ Ø«Ù… Ø§Ø¶ØºØ· <strong>B</strong> Ù„Ø¹Ù…Ù„Ù‡ Ø¹Ø±ÙŠØ¶Ù‹Ø§.  
          Ø£Ø²Ø±Ø§Ø± <strong>â€¢ Ù‚Ø§Ø¦Ù…Ø©</strong> Ùˆ<strong>1. ØªØ¹Ø¯Ø§Ø¯</strong> ØªÙØ¶ÙŠÙØ§Ù† Ù‚ÙˆØ§Ø¦Ù….  
          Ø§Ø®ØªØ± Ù„ÙˆÙ†Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ù„ØªØ·Ø¨ÙŠÙ‚Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ¯. Ø²Ø± ğŸ§¹ ÙŠÙÙ†Ø¸Ù‘Ù Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©.
        </small>
      </form>
    </section>
  </div>

  <!-- ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø©: Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ + Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© + ÙƒÙ„ Ø³ÙƒØ±Ø¨ØªØ§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->

  <!-- Ø³ÙƒØ±Ø¨Øª Ù…Ø­Ø±Ù‘Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ©) -->
  <script>
    const editor  = document.getElementById('m_editor');
    const bodyFld = document.getElementById('id_body'); // Ù…Ù† cform.body
    const btnBold = document.getElementById('m_bold');
    const btnUL   = document.getElementById('m_ul');
    const btnOL   = document.getElementById('m_ol');
    const clean   = document.getElementById('m_clean');

    // Ø­Ù…Ù‘Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ù‘Ø± (Ø¨Ø¯ÙˆÙ† Ø±Ø³Ø§Ø¦Ù„ <em>)
    editor.innerHTML = bodyFld ? bodyFld.value : '';

    function focusEditor(){ editor.focus(); }

    // Ø£Ø¯ÙˆØ§Øª ØªÙ†Ø³ÙŠÙ‚ Ø£Ø³Ø§Ø³ÙŠØ©
    btnBold?.addEventListener('click', () => { focusEditor(); document.execCommand('bold', false, null); });
    btnUL  ?.addEventListener('click', () => { focusEditor(); document.execCommand('insertUnorderedList', false, null); });
    btnOL  ?.addEventListener('click', () => { focusEditor(); document.execCommand('insertOrderedList', false, null); });

    // Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†: 4 Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ©
    document.querySelectorAll('.palette .sw').forEach(sw => {
      sw.addEventListener('click', () => {
        const color = sw.dataset.color;
        focusEditor();
        document.execCommand('foreColor', false, color);
      });
    });

    // ØªÙ†Ø¸ÙŠÙ: Ø¥Ø²Ø§Ù„Ø© &nbsp;ØŒ ØªÙ‚Ù„ÙŠØµ Ø§Ù„Ù…Ø³Ø§ÙØ§ØªØŒ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø­ÙˆÙ„ Ø§Ù„ÙˆØ³ÙˆÙ…
    clean  ?.addEventListener('click', () => {
      const html = editor.innerHTML
        .replace(/&nbsp;/g, ' ')
        .replace(/\s{2,}/g, ' ')
        .replace(/>\s+/g, '>')
        .replace(/\s+</g, '<')
        .trim();
      editor.innerHTML = html;
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸: Ø§Ù†Ø³Ø® HTML Ù„Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ù…Ø®ÙÙŠ body ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('contentForm')?.addEventListener('submit', () => {
      if (bodyFld) bodyFld.value = editor.innerHTML.trim();
    });
  </script>
</body>
</html>
